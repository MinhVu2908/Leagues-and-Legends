(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))n(s);new MutationObserver(s=>{for(const i of s)if(i.type==="childList")for(const r of i.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&n(r)}).observe(document,{childList:!0,subtree:!0});function a(s){const i={};return s.integrity&&(i.integrity=s.integrity),s.referrerPolicy&&(i.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?i.credentials="include":s.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function n(s){if(s.ep)return;s.ep=!0;const i=a(s);fetch(s.href,i)}})();class A{constructor(t,a,n,s={}){const{r:i=36,speed:r=12,hp:c=100,damage:f=20,critChance:d=.12}=s;this.x=t,this.y=a,this.color=n,this.r=i;const u=Math.random()*Math.PI*2;this.vx=Math.cos(u)*r,this.vy=Math.sin(u)*r,this.maxHp=c,this.hp=c,this.damage=f,this.alive=!0,this.critChance=d,this.lastCrit=0,this.typeName=s.typeName||"Normal Ball",this.slow=null,this.combo=0,this.comboTimer=0}update(t,a=16){const n=Date.now(),s=this.stunExpireAt&&this.stunExpireAt>n;let i=1;this.slow&&(this.slow.remaining-=a,this.slow.remaining<=0?this.slow=null:i*=1-(this.slow.percent||0)),s||(this.x+=this.vx*i,this.y+=this.vy*i);const r=t.W,c=t.H;this.x<this.r&&(this.x=this.r,this.vx=Math.abs(this.vx),this.randomize()),this.x>r-this.r&&(this.x=r-this.r,this.vx=-Math.abs(this.vx),this.randomize()),this.y<this.r&&(this.y=this.r,this.vy=Math.abs(this.vy),this.randomize()),this.y>c-this.r&&(this.y=c-this.r,this.vy=-Math.abs(this.vy),this.randomize()),this.lastCrit>0&&(this.lastCrit=Math.max(0,this.lastCrit-a)),this.combo>0&&(this.comboTimer-=a,this.comboTimer<=0&&(this.combo=0,this.comboTimer=0))}applySlow(t,a){if(!(!t||t<=0)&&!(!a||a<=0)){if(!this.slow){this.slow={percent:t,remaining:a};return}if(t>this.slow.percent){this.slow.percent=t,this.slow.remaining=a;return}this.slow.remaining=Math.max(this.slow.remaining,a)}}randomize(){const t=Math.atan2(this.vy,this.vx)+(Math.random()-.5)*.6,a=Math.hypot(this.vx,this.vy);this.vx=Math.cos(t)*a,this.vy=Math.sin(t)*a}draw(t){t.save(),this.lastCrit>0&&(t.shadowBlur=18,t.shadowColor="#ffd54f"),t.beginPath(),t.fillStyle=this.alive?this.color:"rgba(120,120,120,0.45)",t.arc(this.x,this.y,this.r,0,Math.PI*2),t.fill(),t.lineWidth=3,t.strokeStyle="#000",t.stroke(),t.restore(),this.slow&&(t.save(),t.beginPath(),t.lineWidth=4,t.strokeStyle="rgba(33,150,243,0.5)",t.arc(this.x,this.y,this.r+4,0,Math.PI*2),t.stroke(),t.restore());const a=Date.now();if(this.stunExpireAt&&this.stunExpireAt>a)t.save(),t.beginPath(),t.lineWidth=5,t.strokeStyle="#ff1744",t.arc(this.x,this.y,this.r+6,0,Math.PI*2),t.stroke(),t.restore();else if(this.stunStacks&&this.stunStacks>0){t.save();const s=this.y+this.r+12,i=this.r*1.5,r=6,c=4;t.fillStyle="rgba(0,0,0,0.5)",t.fillRect(this.x-i/2,s,i,r);const f=this.stunStacks/c;t.fillStyle="#ff9800",t.fillRect(this.x-i/2,s,i*f,r),t.strokeStyle="#fff",t.lineWidth=1,t.strokeRect(this.x-i/2,s,i,r),t.strokeStyle="rgba(255,255,255,0.6)",t.lineWidth=1;for(let d=1;d<4;d++){const u=this.x-i/2+i*d/4;t.beginPath(),t.moveTo(u,s),t.lineTo(u,s+r),t.stroke()}t.restore()}}}class bt extends A{constructor(t,a,n,s={}){const i={r:18,speed:20,hp:1e3,damage:150,critChance:.25};super(t,a,n,Object.assign({},i,s)),this.typeName="Small Ball"}}class wt extends A{constructor(t,a,n,s={}){const i={r:56,speed:7,hp:2e3,damage:100,critChance:.06};super(t,a,n,Object.assign({},i,s)),this.typeName="Big Ball"}}class Mt extends A{constructor(t,a,n,s={}){const i={r:36,speed:10,hp:1500,damage:40,critChance:.08,poisonDmg:15,poisonDuration:5e3,poisonInterval:600};super(t,a,n,Object.assign({},i,s)),this.poisonDmg=s.poisonDmg??i.poisonDmg,this.poisonDuration=s.poisonDuration??i.poisonDuration,this.poisonInterval=s.poisonInterval??i.poisonInterval,this.typeName="Poison Ball"}applyPoison(t,a){if(!t||!t.alive)return;const n=Math.max(1,Math.floor(this.poisonDuration/this.poisonInterval));let s=0;const i=setInterval(()=>{if(!t||!t.alive){clearInterval(i);return}s+=1;const r=Math.round(this.poisonDmg);typeof a=="function"?a(t,r,!1,!0):t.hp-=r,t.hp<=0&&(t.hp=0,t.alive=!1,t.vx=t.vy=0,clearInterval(i)),s>=n&&clearInterval(i)},this.poisonInterval)}}class St{constructor(t,a,n,s,i=null,r={}){const{r:c=6,life:f=2e3,damage:d=50,color:u="#8d6e63"}=r;this.x=t,this.y=a,this.vx=n,this.vy=s,this.r=c,this.life=f,this.damage=d,this.color=u,this.age=0,this.alive=!0,this.owner=i}update(t,a=16){if(this.alive){if(this.age+=a,this.age>=this.life){this.alive=!1;return}this.x+=this.vx,this.y+=this.vy,(this.x<-50||this.x>t.W+50||this.y<-50||this.y>t.H+50)&&(this.alive=!1)}}draw(t){this.alive&&(t.save(),t.beginPath(),t.fillStyle=this.color,t.arc(this.x,this.y,this.r,0,Math.PI*2),t.fill(),t.lineWidth=1,t.strokeStyle="rgba(0,0,0,0.6)",t.stroke(),t.restore())}}class Dt extends A{constructor(t,a,n,s={}){const i={r:44,speed:8,hp:1800,damage:100,critChance:.05,shootInterval:2400,spikesPerShot:12,spikeSpeed:10,spikeDamage:50};super(t,a,n,Object.assign({},i,s)),this.shootInterval=s.shootInterval??i.shootInterval,this.spikesPerShot=s.spikesPerShot??i.spikesPerShot,this.spikeSpeed=s.spikeSpeed??i.spikeSpeed,this.spikeDamage=s.spikeDamage??i.spikeDamage,this.shootTimer=Math.random()*this.shootInterval,this.pendingSpikes=[],this.typeName="Spiker Ball"}update(t,a=16){if(super.update(t,a),this.shootTimer-=a,this.shootTimer<=0){this.shootTimer+=this.shootInterval;const n=[],s=Math.max(3,Math.floor(this.spikesPerShot));for(let i=0;i<s;i++){const r=i/s*Math.PI*2,c=Math.cos(r)*this.spikeSpeed,f=Math.sin(r)*this.spikeSpeed,d=this.x+Math.cos(r)*(this.r+4),u=this.y+Math.sin(r)*(this.r+4);n.push(new St(d,u,c,f,this,{damage:this.spikeDamage,r:6,life:2600,color:"#8fbc8f"}))}this.pendingSpikes=n}}}class kt extends A{constructor(t,a,n,s={}){const i={r:40,speed:9,hp:1400,damage:90,critChance:.06,slowPercent:.8,slowDuration:1500};super(t,a,n,Object.assign({},i,s)),this.slowPercent=s.slowPercent??i.slowPercent,this.slowDuration=s.slowDuration??i.slowDuration,this.typeName="Ice Ball"}applySlow(t){!t||!t.alive||typeof t.applySlow=="function"&&t.applySlow(this.slowPercent,this.slowDuration)}}class xt extends A{constructor(t,a,n,s={}){const i={r:36,speed:11,hp:1500,damage:100,critChance:.1,maxStunStacks:4,stunDuration:3e3,bonusOnStunMultiplier:1.5};super(t,a,n,Object.assign({},i,s)),this.maxStunStacks=s.maxStunStacks??i.maxStunStacks,this.stunDuration=s.stunDuration??i.stunDuration,this.bonusOnStunMultiplier=s.bonusOnStunMultiplier??i.bonusOnStunMultiplier,this.typeName="Stun Ball"}applyStun(t){if(!t||!t.alive)return;t.stunStacks||(t.stunStacks=0),t.stunExpireAt||(t.stunExpireAt=0);const a=Date.now();t.stunExpireAt>a||(t.stunStacks=Math.min(this.maxStunStacks,t.stunStacks+1),t.stunStacks>=this.maxStunStacks&&(t.stunExpireAt=a+this.stunDuration,t.vulnerableMultiplier=this.bonusOnStunMultiplier,t.vulnerableUsed=!1,t.stunStacks=0))}}class At{constructor(t,a,n,s,i){this.x=t,this.y=a,this.vx=n,this.vy=s,this.owner=i,this.r=4,this.damage=40,this.alive=!0,this.retracting=!1,this.retractSpeed=12}update(t,a=16){const{W:n,H:s}=t;if(this.retracting)if(this.owner&&this.owner.alive){const i=this.owner.x-this.x,r=this.owner.y-this.y,c=Math.hypot(i,r);if(c<8){this.alive=!1;return}const f=i/c,d=r/c;this.x+=f*this.retractSpeed,this.y+=d*this.retractSpeed}else this.alive=!1;else this.x+=this.vx,this.y+=this.vy,(this.x<this.r||this.x>n-this.r||this.y<this.r||this.y>s-this.r)&&(this.retracting=!0),(this.x<-50||this.x>n+50||this.y<-50||this.y>s+50)&&(this.alive=!1)}draw(t){t.save(),t.fillStyle=this.retracting?"#ffeb3b":"#fff59d",t.beginPath(),t.arc(this.x,this.y,this.r,0,Math.PI*2),t.fill(),t.strokeStyle="#f57f17",t.lineWidth=1,t.stroke(),t.restore()}}class Tt extends A{constructor(t,a,n,s={}){const i={r:36,speed:9,hp:1300,damage:50,critChance:.09,shootInterval:1200};super(t,a,n,Object.assign({},i,s)),this.shootInterval=s.shootInterval??i.shootInterval,this.typeName="Feather Ball",this.pendingFeathers=[],this.lastShootTime=0}update(t,a=16){super.update(t,a),this.pendingFeathers.length=0;const n=Date.now();if(n-this.lastShootTime>=this.shootInterval){this.lastShootTime=n;const s=7;for(let i=0;i<3;i++){const r=Math.PI*2*i/3+(Math.random()-.5)*.3,c=this.x+Math.cos(r)*(this.r+8),f=this.y+Math.sin(r)*(this.r+8),d=Math.cos(r)*s,u=Math.sin(r)*s,b=new At(c,f,d,u,this);this.pendingFeathers.push(b)}}}}class Pt{constructor(t,a,n){this.x=t,this.y=a,this.owner=n,this.r=5,this.damage=50,this.alive=!0,this.lifetime=8e3,this.age=0,this.color="#d32f2f"}update(t,a=16){const{W:n,H:s}=t;this.age+=a,this.age>=this.lifetime&&(this.alive=!1),(this.x<-50||this.x>n+50||this.y<-50||this.y>s+50)&&(this.alive=!1)}draw(t){t.save(),t.fillStyle=this.color,t.beginPath(),t.arc(this.x,this.y,this.r,0,Math.PI*2),t.fill(),t.strokeStyle="#b71c1c",t.lineWidth=1,t.stroke(),t.restore()}}class It extends A{constructor(t,a,n,s={}){const i={r:36,speed:9,hp:1100,damage:80,critChance:.09,mineInterval:800};super(t,a,n,Object.assign({},i,s)),this.mineInterval=s.mineInterval??i.mineInterval,this.typeName="Mine Ball",this.pendingMines=[],this.lastMineTime=0}update(t,a=16){super.update(t,a),this.pendingMines.length=0;const n=Date.now();if(n-this.lastMineTime>=this.mineInterval){this.lastMineTime=n;const s=new Pt(this.x,this.y,this);this.pendingMines.push(s)}}}class Ct extends A{constructor(t,a,n,s={}){const i={r:36,speed:10,hp:1e3,damage:100,critChance:.08,rageHitThreshold:5,rageDuration:4e3,rageScaleFactor:1.4,rageDamageMultiplier:3};super(t,a,n,Object.assign({},i,s)),this.rageHitThreshold=s.rageHitThreshold??i.rageHitThreshold,this.rageDuration=s.rageDuration??i.rageDuration,this.rageScaleFactor=s.rageScaleFactor??i.rageScaleFactor,this.rageDamageMultiplier=s.rageDamageMultiplier??i.rageDamageMultiplier,this.typeName="Rage Ball",this.hitCount=0,this.rageExpireAt=0,this.baseRadius=this.r,this.baseDamage=this.damage}recordHit(){Date.now()>this.rageExpireAt&&(this.hitCount++,this.hitCount>=this.rageHitThreshold&&this.activateRage())}activateRage(){const t=Date.now();this.rageExpireAt=t+this.rageDuration,this.hitCount=0,this.r=Math.round(this.baseRadius*this.rageScaleFactor),this.damage=Math.round(this.baseDamage*this.rageDamageMultiplier)}update(t,a=16){super.update(t,a),Date.now()>this.rageExpireAt&&this.rageExpireAt>0&&(this.r=this.baseRadius,this.damage=this.baseDamage,this.rageExpireAt=0)}draw(t){const n=Date.now()<this.rageExpireAt;if(n&&(t.save(),t.globalAlpha=.3,t.fillStyle="#ff6f00",t.beginPath(),t.arc(this.x,this.y,this.r+8,0,Math.PI*2),t.fill(),t.restore()),super.draw(t),!n&&this.rageHitThreshold>0){const s=this.r*1.5,i=6,r=this.x-s/2,c=this.y-this.r-16;t.save(),t.fillStyle="#333333",t.fillRect(r,c,s,i);const f=Math.min(this.hitCount/this.rageHitThreshold,1);t.fillStyle="#ff6f00",t.fillRect(r,c,s*f,i),t.strokeStyle="#ffffff",t.lineWidth=1,t.strokeRect(r,c,s,i),t.restore()}}}class Bt extends A{constructor(t,a,n,s={}){const i={r:36,speed:11,hp:1100,damage:75,critChance:.08,teleportChance:.25};super(t,a,n,Object.assign({},i,s)),this.teleportChance=s.teleportChance??i.teleportChance,this.typeName="Tele Ball",this.lastHpLost=0}attemptTeleport(t,a){if(Math.random()>this.teleportChance)return!1;const{W:n,H:s}=t,i=this.r+20;return this.x=i+Math.random()*(n-2*i),this.y=i+Math.random()*(s-2*i),this.hp=Math.min(this.maxHp,this.hp+a),!0}}class V extends A{constructor(t,a,n,s={}){const i={r:36,speed:10,hp:1200,damage:85,critChance:.09,hitThreshold:5};super(t,a,n,Object.assign({},i,s)),this.hitThreshold=s.hitThreshold??i.hitThreshold,this.typeName="MiyaBall",this.hitCount=0,this.isAttacking=!1,this.attackStartTime=0,this.attackDuration=2e3,this.slashDuration=1200,this.sheatDuration=800,this.attackTarget=null,this.damagePerCut=70,this.cutsDealt=0,this.maxCuts=5,this.startX=t,this.startY=a,this.teleportPositions=[]}recordHit(){this.isAttacking||this.hitCount++}startAttack(t){this.isAttacking||(this.isAttacking=!0,this.attackStartTime=Date.now(),this.attackTarget=t,this.startX=this.x,this.startY=this.y,this.cutsDealt=0)}updateAttack(t,a,n){const i=Date.now()-this.attackStartTime,r=Math.min(i/this.attackDuration,1);if(r>=1)return this.isAttacking=!1,this.teleportPositions=[],{finished:!0,damageDealt:[]};const c=[],{W:f,H:d}=t;if(r<this.slashDuration/this.attackDuration){const u=r/(this.slashDuration/this.attackDuration),b=Math.floor(u*this.maxCuts);if(b>this.cutsDealt){for(let D=this.cutsDealt;D<b;D++){c.push(this.damagePerCut);const y=this.r+30,T=y+Math.random()*(f-2*y),x=y+Math.random()*(d-2*y);this.teleportPositions.push({x:T,y:x,cutIndex:D}),this.x=T,this.y=x}this.cutsDealt=b}}return{finished:!1,damageDealt:c}}update(t,a=16){this.isAttacking||super.update(t,a)}draw(t){if(this.isAttacking){const n=Date.now()-this.attackStartTime,s=Math.min(n/this.attackDuration,1);if(s<this.slashDuration/this.attackDuration){const i=s/(this.slashDuration/this.attackDuration);t.save(),t.globalAlpha=.8*(1-i),t.strokeStyle="#25b8dd",t.lineWidth=6,t.lineCap="round",t.lineJoin="round";const r=6,c=t.canvas.width/2,f=t.canvas.height/2;for(let d=0;d<r;d++){const u=d/r*Math.PI*2,b=Math.sin(i*Math.PI)*40;t.beginPath();const D=100,y=400,T=c+Math.cos(u)*D,x=f+Math.sin(u)*D,N=c+Math.cos(u)*y,R=f+Math.sin(u)*y,B=c+Math.cos(u+Math.PI/4)*b,I=f+Math.sin(u+Math.PI/4)*b;t.moveTo(T,x),t.quadraticCurveTo(B,I,N,R),t.stroke();const C=u+Math.PI/2.5,m=c+Math.cos(C)*D,H=f+Math.sin(C)*D,E=c+Math.cos(C)*y,W=f+Math.sin(C)*y,L=c+Math.cos(C+Math.PI/4)*b*.7,O=f+Math.sin(C+Math.PI/4)*b*.7;t.beginPath(),t.moveTo(m,H),t.quadraticCurveTo(L,O,E,W),t.stroke()}t.restore()}t.save(),t.globalAlpha=.5,t.fillStyle="#ffd700",t.beginPath(),t.arc(this.x,this.y,this.r+15,0,Math.PI*2),t.fill(),t.restore()}super.draw(t)}}class lt{constructor(t,a,n,s,i=null,r={}){const{r:c=3,life:f=1500,damage:d=8,color:u="#ffeb3b"}=r;this.x=t,this.y=a,this.vx=n,this.vy=s,this.r=c,this.life=f,this.damage=d,this.color=u,this.age=0,this.alive=!0,this.owner=i}update(t,a=16){if(this.alive){if(this.age+=a,this.age>=this.life){this.alive=!1;return}this.x+=this.vx,this.y+=this.vy,(this.x<-50||this.x>t.W+50||this.y<-50||this.y>t.H+50)&&(this.alive=!1)}}draw(t){this.alive&&(t.save(),t.beginPath(),t.fillStyle=this.color,t.arc(this.x,this.y,this.r,0,Math.PI*2),t.fill(),t.lineWidth=.5,t.strokeStyle="rgba(0,0,0,0.4)",t.stroke(),t.restore())}}class Ht extends A{constructor(t,a,n,s={}){const i={r:40,speed:10,hp:1100,damage:85,critChance:.08,shootInterval:10,bulletSpeed:10,bulletDamage:10};super(t,a,n,Object.assign({},i,s)),this.shootInterval=s.shootInterval??i.shootInterval,this.bulletSpeed=s.bulletSpeed??i.bulletSpeed,this.bulletDamage=s.bulletDamage??i.bulletDamage,this.shootTimer=Math.random()*this.shootInterval,this.bulletAngle=0,this.pendingBullets=[],this.typeName="Machine Gun Ball"}update(t,a=16){if(super.update(t,a),this.shootTimer-=a,this.shootTimer<=0){this.shootTimer+=this.shootInterval;const n=this.bulletAngle,s=Math.cos(n)*this.bulletSpeed,i=Math.sin(n)*this.bulletSpeed,r=this.x+Math.cos(n)*(this.r+2),c=this.y+Math.sin(n)*(this.r+2);this.pendingBullets.push(new lt(r,c,s,i,this,{damage:this.bulletDamage,r:3,life:1500,color:"#ffeb3b"})),this.bulletAngle+=Math.PI*2/100,this.bulletAngle>=Math.PI*2&&(this.bulletAngle-=Math.PI*2)}}}class et extends A{constructor(t,a,n,s={}){const i={r:38,speed:10,hp:1100,damage:80,critChance:.08,stackTimeout:2e3,stackThreshold:3,spinDuration:1500,shootInterval:30,bulletSpeed:5,bulletDamage:12};super(t,a,n,Object.assign({},i,s)),this.stackTimeout=s.stackTimeout??i.stackTimeout,this.stackThreshold=s.stackThreshold??i.stackThreshold,this.spinDuration=s.spinDuration??i.spinDuration,this.shootInterval=s.shootInterval??i.shootInterval,this.bulletSpeed=s.bulletSpeed??i.bulletSpeed,this.bulletDamage=s.bulletDamage??i.bulletDamage,this.hitStack=0,this.lastHitAt=0,this.spinning=!1,this.spinExpireAt=0,this.shootTimer=Math.random()*this.shootInterval,this.bulletAngle=0,this.pendingBullets=[],this.typeName="Sami Ball"}recordDeal(){const t=Date.now();this.lastHitAt&&t-this.lastHitAt<=this.stackTimeout?this.hitStack++:this.hitStack=1,this.lastHitAt=t,this.hitStack>=this.stackThreshold&&(this.startSpin(),this.hitStack=0,this.lastHitAt=0)}startSpin(){const t=Date.now();this.spinning=!0,this.spinExpireAt=t+this.spinDuration,this.shootTimer=0,this.bulletAngle=Math.random()*Math.PI*2}update(t,a=16){if(super.update(t,a),this.spinning){if(this.shootTimer-=a,this.shootTimer<=0){this.shootTimer+=this.shootInterval;for(let n=0;n<4;n++){const s=this.bulletAngle+n*(Math.PI/2),i=Math.cos(s)*this.bulletSpeed,r=Math.sin(s)*this.bulletSpeed,c=this.x+Math.cos(s)*(this.r+4),f=this.y+Math.sin(s)*(this.r+4);this.pendingBullets.push(new lt(c,f,i,r,this,{damage:this.bulletDamage,r:4,life:1600,color:"#ff8a65"}))}this.bulletAngle+=Math.PI*2/30,this.bulletAngle>=Math.PI*2&&(this.bulletAngle-=Math.PI*2)}Date.now()>this.spinExpireAt&&(this.spinning=!1,this.spinExpireAt=0)}}draw(t){if(super.draw(t),this.hitStack&&this.hitStack>0){t.save();const a=this.r*.9,n=6,s=this.x-a/2,i=this.y-this.r-14;t.fillStyle="#333",t.fillRect(s,i,a,n);const r=Math.min(this.hitStack/this.stackThreshold,1);t.fillStyle="#29b6f6",t.fillRect(s,i,a*r,n),t.strokeStyle="#fff",t.lineWidth=1,t.strokeRect(s,i,a,n),t.restore()}this.spinning&&(t.save(),t.globalAlpha=.18,t.fillStyle="#ff8a65",t.beginPath(),t.arc(this.x,this.y,this.r+10,0,Math.PI*2),t.fill(),t.restore())}}class Et{constructor(t,a,n,s,i=null,r={}){const{speed:c=12,length:f=200,width:d=430,life:u=3e3,damage:b=60,color:D="#80d8ff"}=r;this.x=t,this.y=a,this.dx=n,this.dy=s,this.vx=n*c,this.vy=s*c,this.length=f,this.width=d,this.life=u,this.damage=b,this.color=D,this.age=0,this.alive=!0,this.owner=i,this._damaged=new Set}update(t,a=16){if(!this.alive)return;if(this.age+=a,this.age>=this.life){this.alive=!1;return}const n=a/16;this.x+=this.vx*n,this.y+=this.vy*n;const s=this.x+this.dx*this.length,i=this.y+this.dy*this.length,r=Math.min(this.x,s),c=Math.max(this.x,s),f=Math.min(this.y,i),d=Math.max(this.y,i),u=200;(c<-u||r>t.W+u||d<-u||f>t.H+u)&&(this.alive=!1)}intersectsCircle(t,a,n){const s=this.x,i=this.y,r=this.x+this.dx*this.length,c=this.y+this.dy*this.length,f=r-s,d=c-i,u=t-s,b=a-i,D=f*u+d*b,y=f*f+d*d;let T=0;y>0&&(T=D/y),T=Math.max(0,Math.min(1,T));const x=s+f*T,N=i+d*T,R=(t-x)*(t-x)+(a-N)*(a-N),B=n+this.width/2;return R<=B*B}markDamaged(t){t&&this._damaged.add(t)}hasDamaged(t){return t&&this._damaged.has(t)}draw(t){this.alive&&(t.save(),t.lineWidth=this.width,t.strokeStyle=this.color,t.lineCap="round",t.beginPath(),t.moveTo(this.x,this.y),t.lineTo(this.x+this.dx*this.length,this.y+this.dy*this.length),t.stroke(),t.restore())}}class Wt extends A{constructor(t,a,n,s={}){const i={r:38,speed:10,hp:1e3,damage:65,critChance:.06,spawnInterval:2400,laserSpeed:5,laserWidth:100,laserDamage:150};super(t,a,n,Object.assign({},i,s)),this.spawnInterval=s.spawnInterval??i.spawnInterval,this.laserSpeed=s.laserSpeed??i.laserSpeed,this.laserWidth=s.laserWidth??i.laserWidth,this.laserDamage=s.laserDamage??i.laserDamage,this.spawnTimer=Math.random()*this.spawnInterval,this.pendingLasers=[],this.typeName="Luxi Ball"}update(t,a=16){if(super.update(t,a),this.spawnTimer-=a,this.spawnTimer<=0){this.spawnTimer+=this.spawnInterval+Math.random()*800;const n=t.W,s=t.H,i=Math.floor(Math.random()*4);let r,c;i===0?(r=-24,c=Math.random()*s):i===1?(r=n+24,c=Math.random()*s):i===2?(r=Math.random()*n,c=-24):(r=Math.random()*n,c=s+24);const f=30+Math.random()*Math.max(0,n-60),d=30+Math.random()*Math.max(0,s-60),u=f-r,b=d-c,D=Math.hypot(u,b)||1,y=u/D,T=b/D,x=new Et(r,c,y,T,this,{speed:0,width:this.laserWidth,damage:this.laserDamage,color:"#b3e5fc",length:Math.max(n,s)*1.2,life:1e3});this.pendingLasers.push(x)}}draw(t){super.draw(t)}}class Ot extends A{constructor(t,a,n,s={}){const i={r:34,speed:11,hp:1200,damage:120,critChance:.13,curveStrength:.2};super(t,a,n,Object.assign({},i,s)),this.curveStrength=s.curveStrength??i.curveStrength,this.typeName="Curve Ball",this.lastBounceTime=0,this.bounceAxis=null}update(t,a=16){this.vx,this.vy;const n=Date.now(),s=this.stunExpireAt&&this.stunExpireAt>n;let i=1;if(this.slow&&(this.slow.remaining-=a,this.slow.remaining<=0?this.slow=null:i*=1-(this.slow.percent||0)),this.bounceAxis&&Date.now()-this.lastBounceTime<400){const f=Math.hypot(this.vx,this.vy);if(this.bounceAxis==="x"){const d=this.curveStrength*(Math.random()>.5?1:-1);this.vy+=d*f;const u=Math.hypot(this.vx,this.vy);this.vx*=f/u,this.vy*=f/u}else if(this.bounceAxis==="y"){const d=this.curveStrength*(Math.random()>.5?1:-1);this.vx+=d*f;const u=Math.hypot(this.vx,this.vy);this.vx*=f/u,this.vy*=f/u}}s||(this.x+=this.vx*i,this.y+=this.vy*i);const r=t.W,c=t.H;this.x<this.r&&(this.x=this.r,this.vx=Math.abs(this.vx),this.bounceAxis="x",this.lastBounceTime=Date.now(),this.randomize()),this.x>r-this.r&&(this.x=r-this.r,this.vx=-Math.abs(this.vx),this.bounceAxis="x",this.lastBounceTime=Date.now(),this.randomize()),this.y<this.r&&(this.y=this.r,this.vy=Math.abs(this.vy),this.bounceAxis="y",this.lastBounceTime=Date.now(),this.randomize()),this.y>c-this.r&&(this.y=c-this.r,this.vy=-Math.abs(this.vy),this.bounceAxis="y",this.lastBounceTime=Date.now(),this.randomize()),this.lastCrit>0&&(this.lastCrit=Math.max(0,this.lastCrit-a)),this.combo>0&&(this.comboTimer-=a,this.comboTimer<=0&&(this.combo=0,this.comboTimer=0))}draw(t){super.draw(t)}}class Nt{constructor(t,a,n=100,s=14){this.x=t,this.y=a,this.healAmount=n,this.r=s,this.alive=!0,this.pulse=0}update(t){this.pulse+=t*.006}draw(t){t.save();const a=1+Math.sin(this.pulse)*.08;t.translate(this.x,this.y),t.scale(a,a),t.beginPath(),t.arc(0,0,this.r+6,0,Math.PI*2),t.fillStyle="rgba(102, 187, 106, 0.08)",t.fill(),t.beginPath(),t.arc(0,0,this.r,0,Math.PI*2),t.fillStyle="linear-gradient(90deg,#a5d6a7,#66bb6a)",t.fillStyle="#66bb6a",t.fill(),t.lineWidth=2,t.strokeStyle="#2e7d32",t.stroke(),t.beginPath(),t.moveTo(-6,0),t.lineTo(6,0),t.moveTo(0,-6),t.lineTo(0,6),t.strokeStyle="#e8f5e9",t.lineWidth=3,t.stroke(),t.restore()}}document.addEventListener("DOMContentLoaded",()=>{const g=document.getElementById("c"),t=g.getContext("2d"),a=g.width,n=g.height,s=36,i=12,r=document.getElementById("hpA-fill"),c=document.getElementById("hpB-fill"),f=document.getElementById("hpA-text"),d=document.getElementById("hpB-text"),u=document.getElementById("comboA-text"),b=document.getElementById("comboB-text"),D=document.getElementById("countdown");function y(h,e,o,l){return Math.hypot(o-h,l-e)}class T{constructor(e,o,l,p=!1,w=!1){this.x=e,this.y=o,this.amount=l,this.isCrit=!!p,this.isPoison=!!w,this.life=800,this.age=0,this.vy=-.03-Math.random()*.05,this.alpha=1}update(e){this.age+=e,this.y+=this.vy*e,this.alpha=1-this.age/this.life}draw(e){e.save(),e.globalAlpha=Math.max(0,this.alpha);const o=this.amount<0;let l;this.isCrit?l="#ffd54f":this.isPoison?l="#1b5e20":o?l="#b9f6ca":l="#fff",e.fillStyle=l,e.font=this.isCrit?"24px system-ui":"20px system-ui",e.textAlign="center",e.lineWidth=4,e.strokeStyle="rgba(0,0,0,0.6)";const p=this.amount>0?`-${this.amount}`:`+${Math.abs(this.amount)}`,w=this.isCrit?`${p}!`:p;e.strokeText(w,this.x,this.y),e.fillText(w,this.x,this.y),e.restore()}expired(){return this.age>=this.life}}const x=[];function N(h,e,o,l=!1,p=!1){x.push(new T(h,e,o,l,p))}const R=new Audio("/sound/hit.mp3"),B=new Audio("/sound/critHit.mp3");R.volume=.46,B.volume=.46;function I(h,e,o=!1,l=!1,p=null){if(!(!h||!h.alive)&&!(!e||e<=0)){h.vulnerableMultiplier&&!h.vulnerableUsed&&(e=Math.round(e*h.vulnerableMultiplier),h.vulnerableUsed=!0),h.hp-=e,h.hp<=0&&(h.hp=0,h.alive=!1,h.vx=h.vy=0,h.combo=0),N(h.x,h.y-h.r-6,e,o,l),p&&(p.combo||(p.combo=0),p.combo++,p.comboTimer=1e3);try{o?(B.currentTime=0,B.play().catch(()=>{})):(R.currentTime=0,R.play().catch(()=>{}))}catch{}}}function C(){const h={x:s+Math.random()*(a-2*s),y:s+Math.random()*(n-2*s)};let e,o=0;do e={x:s+Math.random()*(a-2*s),y:s+Math.random()*(n-2*s)},o++;while(y(h.x,h.y,e.x,e.y)<2*s+8&&o<200);function l(M,S){const Y=["#4fc3f7","#f06292","#ffd54f","#90caf9","#a5d6a7"],v=Y[Math.floor(Math.random()*Y.length)],k=Math.floor(Math.random()*17);return k===1?new bt(M,S,v,{}):k===2?new wt(M,S,v,{}):k===3?new Mt(M,S,v,{}):k===4?new Dt(M,S,v,{}):k===5?new kt(M,S,v,{}):k===6?new xt(M,S,v,{}):k===7?new Tt(M,S,v,{}):k===8?new It(M,S,v,{}):k===9?new Ct(M,S,v,{}):k===10?new Bt(M,S,v,{}):k===11?new V(M,S,v,{}):k===12?new et(M,S,v,{}):k===13?new Wt(M,S,v,{}):k===14?new Ht(M,S,v,{}):k===15?new Ot(M,S,v,{}):new A(M,S,v,{r:s,speed:i,hp:1200,damage:100})}const p=l(h.x,h.y);let w,j=0;do w=l(e.x,e.y),j++;while(w&&p&&w.constructor===p.constructor&&j<200);return[p,w]}let m=C(),H=[],E=[],W=[],L=[],O=[],$=[],_=!1,z=null,G=!1,P=null;function J(){const e=24+Math.random()*(a-48),o=24+Math.random()*(n-2*24);P=new Nt(e,o,300,14)}J();let q=!1,U=0;const ct=3e3;function ft(){return m.filter(e=>e.alive).length<=1}function ut(){q=!0,U=ct,K()}function st(){q=!1,U=0,K()}function K(){if(!q){D.textContent="";return}const h=Math.ceil(U/1e3);D.textContent=`Next fight in: ${h}`}function dt(){const h=m[0],e=m[1],o=y(h.x,h.y,e.x,e.y);if(o<=h.r+e.r){const p=(e.x-h.x)/o,w=(e.y-h.y)/o,j=h.r+e.r-o;h.x-=p*j/2,h.y-=w*j/2,e.x+=p*j/2,e.y+=w*j/2;const M=Math.hypot(h.vx,h.vy),S=Math.hypot(e.vx,e.vy),Y=h.vx*p+h.vy*w,v=e.vx*p+e.vy*w,k=h.vx-Y*p,gt=h.vy-Y*w,yt=e.vx-v*p,vt=e.vy-v*w;h.vx=k+v*p,h.vy=gt+v*w,e.vx=yt+Y*p,e.vy=vt+Y*w;const at=Math.hypot(h.vx,h.vy)||1,nt=Math.hypot(e.vx,e.vy)||1;if(h.vx*=M/at,h.vy*=M/at,e.vx*=S/nt,e.vy*=S/nt,!G){if(h.alive&&e.alive){const ht=Date.now(),ot=h.stunExpireAt&&h.stunExpireAt>ht,rt=e.stunExpireAt&&e.stunExpireAt>ht,Z=Math.random()<(e.critChance||0),tt=Math.random()<(h.critChance||0),F=rt?0:Math.round(e.damage*(Z?2:1)),X=ot?0:Math.round(h.damage*(tt?2:1));I(h,F,Z,!1,e),I(e,X,tt,!1,h),typeof h.attemptTeleport=="function"&&F>0&&h.attemptTeleport({W:a,H:n},F),typeof e.attemptTeleport=="function"&&X>0&&e.attemptTeleport({W:a,H:n},X),tt&&!ot&&(h.lastCrit=700),Z&&!rt&&(e.lastCrit=700),typeof e.applyPoison=="function"&&e.applyPoison(h,I),typeof h.applyPoison=="function"&&h.applyPoison(e,I),typeof e.applySlow=="function"&&e.applySlow(h),typeof h.applySlow=="function"&&h.applySlow(e),typeof e.applyStun=="function"&&e.applyStun(h),typeof h.applyStun=="function"&&h.applyStun(e),typeof h.recordHit=="function"&&F>0&&h.recordHit(),typeof e.recordHit=="function"&&X>0&&e.recordHit(),e instanceof V&&F>0&&e.hitCount++,h instanceof V&&X>0&&h.hitCount++,e instanceof et&&F>0&&typeof e.recordDeal=="function"&&e.recordDeal(),h instanceof et&&X>0&&typeof h.recordDeal=="function"&&h.recordDeal(),e instanceof V&&e.hitCount>=e.hitThreshold&&(_=!0,z=e,e.startAttack(h),e.hitCount=0),h instanceof V&&h.hitCount>=h.hitThreshold&&(_=!0,z=h,h.startAttack(e),h.hitCount=0),typeof h.randomize=="function"&&h.randomize(),typeof e.randomize=="function"&&e.randomize(),h.hp<=0&&(h.hp=0,h.alive=!1,h.vx=h.vy=0),e.hp<=0&&(e.hp=0,e.alive=!1,e.vx=e.vy=0)}G=!0}}else G=!1}function pt(){if(!(!P||!P.alive))for(const h of m){if(!h.alive)continue;if(y(h.x,h.y,P.x,P.y)<=h.r+P.r){const o=Math.min(P.healAmount,h.maxHp-h.hp);o>0&&(h.hp+=o,N(h.x,h.y-h.r-6,-o)),P.alive=!1,setTimeout(()=>{J()},2e3+Math.random()*4e3);break}}}function mt(){if(t.clearRect(0,0,a,n),t.strokeStyle="#000",t.lineWidth=6,t.strokeRect(2,2,a-4,n-4),_&&z){const e=z,o=m[0]===e?m[1]:m[0],l=e.updateAttack({W:a,H:n},o.x,o.y);for(const p of l.damageDealt)I(o,p,!1,!1,e);l.finished&&(_=!1,z=null);for(const p of m)p.draw(t)}else{for(const e of m)e.alive&&e.update({W:a,H:n},16);for(const e of m)if(e.pendingSpikes&&e.pendingSpikes.length){for(const o of e.pendingSpikes)H.push(o);e.pendingSpikes.length=0}for(const e of m)if(e.pendingFeathers&&e.pendingFeathers.length){for(const o of e.pendingFeathers)E.push(o);e.pendingFeathers.length=0}for(const e of m)if(e.pendingMines&&e.pendingMines.length){for(const o of e.pendingMines)W.push(o);e.pendingMines.length=0}for(const e of m)if(e.pendingBullets&&e.pendingBullets.length){for(const o of e.pendingBullets)O.push(o);e.pendingBullets.length=0}for(const e of m)if(e.pendingLasers&&e.pendingLasers.length){for(const o of e.pendingLasers)$.push(o);e.pendingLasers.length=0}dt();for(const e of m)e.draw(t)}for(let e=H.length-1;e>=0;--e){const o=H[e];if(o.update({W:a,H:n},16),!o.alive){H.splice(e,1);continue}for(const l of m){if(!l.alive||l===o.owner)continue;if(y(l.x,l.y,o.x,o.y)<=l.r+o.r){I(l,o.damage,!1,!1,o.owner),o.alive=!1;break}}}for(const e of H)e.draw(t);for(let e=E.length-1;e>=0;--e){const o=E[e];if(o.update({W:a,H:n},16),!o.alive){E.splice(e,1);continue}for(const l of m){if(!l.alive||l===o.owner)continue;if(y(l.x,l.y,o.x,o.y)<=l.r+o.r){I(l,o.damage,!1,!1,o.owner),o.alive=!1;break}}}for(const e of E)e.draw(t);for(let e=W.length-1;e>=0;--e){const o=W[e];if(o.update({W:a,H:n},16),!o.alive){W.splice(e,1);continue}for(const l of m){if(!l.alive||l===o.owner)continue;if(y(l.x,l.y,o.x,o.y)<=l.r+o.r){I(l,o.damage,!1,!1,o.owner),o.alive=!1;break}}}for(const e of W)e.draw(t);for(let e=O.length-1;e>=0;--e){const o=O[e];if(o.update({W:a,H:n},16),!o.alive){O.splice(e,1);continue}for(const l of m){if(!l.alive||l===o.owner)continue;if(y(l.x,l.y,o.x,o.y)<=l.r+o.r){I(l,o.damage,!1,!1,o.owner),o.alive=!1;break}}}for(const e of O)e.draw(t);for(let e=$.length-1;e>=0;--e){const o=$[e];if(o.update({W:a,H:n},16),!o.alive){$.splice(e,1);continue}for(const l of m)l.alive&&l!==o.owner&&(o.hasDamaged(l)||o.intersectsCircle(l.x,l.y,l.r)&&(I(l,o.damage,!1,!1,o.owner),o.markDamaged(l)))}for(const e of $)e.draw(t);for(let e=L.length-1;e>=0;--e){const o=L[e];if(o.update({W:a,H:n},16),!o.alive){L.splice(e,1);continue}for(const l of m){if(!l.alive||l===o.owner)continue;y(l.x,l.y,o.x,o.y)<=l.r+o.r&&o.canDamage(l)&&(I(l,o.damage,!1,!1,o.owner),o.markDamaged(l))}}for(const e of L)e.draw(t);P&&P.alive&&(P.update(16),P.draw(t));for(let e=x.length-1;e>=0;--e){const o=x[e];o.update(16),o.draw(t),o.expired()&&x.splice(e,1)}if(pt(),Q(),ft()&&(q||ut()),q)if(U-=16,U<=0){m=C();for(const e of m)e.combo=0;x.length=0,H.length=0,E.length=0,W.length=0,O.length=0,L.length=0,P=null,J(),G=!1,st(),Q()}else K()}function Q(){const h=m[0],e=m[1],o=Math.max(0,Math.min(1,h.hp/h.maxHp)),l=Math.max(0,Math.min(1,e.hp/e.maxHp));r.style.width=`${o*100}%`,c.style.width=`${l*100}%`,f.textContent=`${h.typeName} — ${Math.round(h.hp)} / ${h.maxHp}`,d.textContent=`${e.typeName} — ${Math.round(e.hp)} / ${e.maxHp}`,f.style.color=h.color,d.style.color=e.color,u.textContent=h.combo?`Combo: ${h.combo}`:"",b.textContent=e.combo?`Combo: ${e.combo}`:"",r.style.background=o>.5?"linear-gradient(90deg,#4caf50,#66bb6a)":o>.2?"linear-gradient(90deg,#ffa726,#ffb74d)":"linear-gradient(90deg,#f44336,#ef5350)",c.style.background=l>.5?"linear-gradient(90deg,#4caf50,#66bb6a)":l>.2?"linear-gradient(90deg,#ffa726,#ffb74d)":"linear-gradient(90deg,#f44336,#ef5350)"}function it(){mt(),requestAnimationFrame(it)}it(),document.getElementById("reset").addEventListener("click",()=>{st(),m=C();for(const h of m)h.combo=0;x.length=0,P=null,J(),Q()})});
